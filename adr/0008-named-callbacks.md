# 8: Alias Function in Capability Class "Named Callbacks"

Date: 2024-03-21

## Status

Accepted.

## Context

Currently, Pepr utilizes function callback names to produce logs during execution. This approach -- when configured via nameless arrow function expression -- leads to challenges in debugging and testing. The logs generated by these callbacks lack clear, module author defined identifiers, making it difficult to ascertain which callback produced which effect unless manual names are embedded into log messages from within the callbacks themselves.


## Decision Drivers

The key drivers for this decision include:

- **Devex**: Instead of manual declaration of `const name = "my-action";` in each callback and each log (which is easy to forget and tedious to do), we can add a name to the callback to make it easier to identify the source of logs. `Alias("my-action")`
- **Debugging Efficiency**: The debugging process in the current system is time-consuming and error-prone due to the anonymous nature of callbacks.  
- **Code Readability**: Anonymous callbacks can make the code harder to understand, especially for new developers or when returning to old code that has a different form of naming.
- **Maintenance and Scalability**: As the system grows, the manageability of anonymous callbacks becomes increasingly burdensome to maintain a consistent state of naming across actions.
- **Error Tracing**: Pinpointing the source of errors or unexpected behavior in the system is complex without clear identification of each callback.


## Considered Options

1. **Named Callbacks**: Add an optional name to the callback to make it easier to identify the source of logs. `Alias("my-action")`.
2. **Maintain Anonymous Callbacks**: Continue using anonymous callbacks without any changes and move this responsibility to the module author. 

## Decision Outcome 

Chosen option: "Named Callbacks", because it provides a clear and consistent way to identify the source of logs and makes the code easier to understand, debug, and test with an easy developer experience.

```ts
// Watch for changes to the UDSPackage CRD to enqueue a package for processing
When(UDSPackage)
  .IsCreatedOrUpdated()
  // Advanced CR Validation
  .Validate(validator)
  // Enqueue the package for processing
  .Reconcile(reconciler)
  .Alias("UDS Operator Reconciler")
```


## Benefits

- Simpler developer experience by reducing workload on the module author.
- Improved Logs and Debugging by programmatically identifying the source of logs in a repeatable fashion across modules.

## Consequences

1. Add another optional function to the Capability class, `Alias`, to add a name to the callback (and add a default, generated name for Pepr to use when a dev forgets to set one).
2. Add Unit and Integration tests to ensure the new functionality works as expected.
3. Add documentation for the new functionality.
